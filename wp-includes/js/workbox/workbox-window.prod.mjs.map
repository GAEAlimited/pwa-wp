{"version":3,"names":[],"mappings":"","sources":["packages/workbox-window/index.mjs"],"sourcesContent":["try{self[\"workbox:window:4.0.0-rc.0\"]&&_()}catch(t){}const t=(t,s)=>new Promise(i=>{let e=new MessageChannel;e.port1.onmessage=(t=>i(t.data)),t.postMessage(s,[e.port2])});try{self[\"workbox:core:4.0.0-rc.0\"]&&_()}catch(t){}class s{constructor(){this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}}class i{constructor(){this.t={}}addEventListener(t,s){this.s(t).add(s)}removeEventListener(t,s){this.s(t).remove(s)}dispatchEvent(t){t.target=this,this.s(t.type).forEach(s=>s(t))}s(t){return this.t[t]=this.t[t]||new Set}}const e=(t,s)=>new URL(t,location).href===new URL(s,location).href;class n{constructor(t,s){Object.assign(this,s,{type:t})}}const h=200,a=6e4;class o extends i{constructor(t,i={}){super(),this.i=t,this.e=i,this.n=0,this.h=new s,this.a=new s,this.o=new s,this.r=this.r.bind(this),this.c=this.c.bind(this),this.l=this.l.bind(this),this.g=this.g.bind(this)}async register({immediate:t=!1}={}){return t||\"complete\"===document.readyState||await new Promise(t=>addEventListener(\"load\",t)),this.w=await this.d(),this.u=await this.m(),this.w&&(this.v=this.w,this.h.resolve(this.w),this.a.resolve(this.w),this.o.resolve(this.w),this.p(this.w),this.w.addEventListener(\"statechange\",this.c,{once:!0})),this.u.addEventListener(\"updatefound\",this.l),navigator.serviceWorker.addEventListener(\"controllerchange\",this.g,{once:!0}),\"BroadcastChannel\"in self&&(this.y=new BroadcastChannel(\"workbox\"),this.y.addEventListener(\"message\",this.r)),navigator.serviceWorker.addEventListener(\"message\",this.r),this.u}get active(){return this.a.promise}get controlling(){return this.o.promise}async getSW(){return this.h.promise}async messageSW(t){const s=await this.getSW();return new Promise(i=>{let e=new MessageChannel;e.port1.onmessage=(t=>i(t.data)),s.postMessage(t,[e.port2])})}async d(){const t=navigator.serviceWorker.controller;if(t&&e(t.scriptURL,this.i))return t}async m(){try{const t=await navigator.serviceWorker.register(this.i,this.e);return this._=performance.now(),t}catch(t){throw t}}p(s){t(s,{type:\"WINDOW_READY\",meta:\"workbox-window\"})}l(){const t=this.u.installing;this.n>0||!e(t.scriptURL,this.i)||performance.now()>this._+a?(this.f=t,this.u.removeEventListener(\"updatefound\",this.l)):(this.v=t,this.h.resolve(t)),++this.n,t.addEventListener(\"statechange\",this.c)}c(t){const s=t.target,{state:i}=s,e=s===this.f,a=e?\"external\":\"\";this.dispatchEvent(new n(a+i,{sw:s,originalEvent:t})),\"installed\"===i?this.C=setTimeout(()=>{\"installed\"===i&&this.u.waiting===s&&this.dispatchEvent(new n(a+\"waiting\",{sw:s,originalEvent:t}))},h):\"activating\"===i&&(clearTimeout(this.C),e||this.a.resolve(s))}g(t){const s=this.v;s===navigator.serviceWorker.controller&&(this.dispatchEvent(new n(\"controlling\",{sw:s,originalEvent:t})),this.o.resolve(s))}r(t){const{data:s}=t;this.dispatchEvent(new n(\"message\",{data:s,originalEvent:t}))}}export{o as Workbox,t as messageSW};\n"],"file":"workbox-window.prod.mjs"}